#include variables
#!/bin/sh -e
# 
# config maintainer script for the Debian <:=${PACKAGE}:> package.
# $Id: config.in 114 2005-08-04 15:04:01Z frn $
<:=@COPYRIGHT:>//

# Give names to the commandline arguments
action=$1
installed_version=$2


. <:=${CONFMODULE}:>
db_version 2.0

<:open(FUNCTIONS,'common.functions');@FUNCTIONS=<FUNCTIONS>;close(FUNCTIONS):>//
<:=@FUNCTIONS:>//

## do the things we have to do for upgraders from old versions
# it does not harm to do the checks also when $action is reconfigure.

# suggest a user to rename old cnf files (copyright Atsuhito?)
# (upgrade from woody, keep for etch?)
if [ -d /etc/texmf/texmf.d ]; then
    if ls /etc/texmf/texmf.d 2> /dev/null | egrep -vq '(\.cnf|\.dpkg-.*|~)$'; then
	db_input medium tex-common/cnf_name || true
	db_go || true
    fi
fi


# we also unregister the tetex-bin/lsr-perms
db_unregister tetex-bin/lsr-perms || true

# and unregister old tex-common questions, they are not needed anymore
db_unregister tex-common/groupperm || true
db_unregister tex-common/userperm || true
db_unregister tex-common/managedlsr || true

# we set the groupname seen flag to false in any case since now it has
# a completely new meaning
db_fset tex-common/groupname seen false || true

# this script may be run twice: Once by dpkg-preconfigure, once again by
# debconf when it is sourced in the postinst script.  We must do the
# following only once, therefore we fiddle with a special flag
db_fget tex-common/managecache firstrundone || true

if [ "$RET" != "true" ]; then
  # we are in the first pass, set the flag and do the things
  db_fset tex-common/managecache firstrundone true

  # check wether the directory /var/cache/fonts is group writeable and
  # for which group
  PERMS=$(stat --format="%a" /var/cache/fonts)
  GROUP=$(stat --format="%G" /var/cache/fonts)
  if [ $PERMS = 2775 ] ; then
    db_set tex-common/managecache true || true
    db_set tex-common/groupname "$GROUP" || true
  else
    db_set tex-common/managecache false || true
  fi
  db_input low tex-common/managecache || true
  db_go

  db_get tex-common/managecache || true
  if [ "$RET" = true ]; then
    db_input low tex-common/groupname || true
    db_go
  fi
fi

# Local Variables:
# mode: shell-script
# skeleton-pair: t
# End:

